# 博客项目

## 一、项目概述

基于 **Go + Gin** 框架开发的博客系统（项目名：bell-best/bluebell），实现了用户注册登录、帖子发布、社区管理、投票等核心功能。

## 二、项目完整性分析

###  已实现的功能模块

1. **用户模块**
   -  用户注册 (`/api/v1/signup`)
   -  用户登录 (`/api/v1/login`)
   -  JWT 认证中间件
   -  密码加密（MD5）

2. **帖子模块**
   -  创建帖子 (`/api/v1/post`)
   -  获取帖子详情 (`/api/v1/post/:id`)
   -  帖子列表查询 (`/api/v1/posts/`, `/api/v1/posts2/`)
   -  支持按时间/分数排序

3. **社区模块**
   -  社区列表 (`/api/v1/community`)
   -  社区详情 (`/api/v1/community/:id`)

4. **投票模块**
   -  帖子投票功能 (`/api/v1/vote`)
   -  Redis 缓存投票数据

5. **技术特性**
   -  日志系统（zap + lumberjack）
   -  配置管理（viper）
   -  数据库连接池管理
   -  Redis 缓存
   -  雪花算法 ID 生成
   -  Swagger API 文档
   -  优雅关闭服务

###  需要注意的问题

1. **安全性问题**
   - JWT 密钥硬编码在代码中（`pkg/jwt/jwt.go` 第11行）
   - 密码加密使用 MD5（建议升级为 bcrypt）
   - 配置文件包含敏感信息（数据库密码）

2. **配置问题**
   - `config.yaml` 中的数据库密码为默认值 "123456"
   - Redis 密码为空（如果 Redis 设置了密码需要配置）

3. **数据库初始化**
   - 需要手动执行 `models/create_table.sql` 创建表结构
   - 需要创建数据库 `bluebell`

## 三、本地部署指南

### 前置要求

1. **Go 环境**
   - Go 版本：1.22.4 或更高
   - 检查命令：`go version`

2. **MySQL 数据库**
   - 版本：5.7+ 或 8.0+
   - 需要创建数据库和表

3. **Redis 服务**
   - 版本：5.0+ 或 6.0+
   - 默认端口：6379

### 部署步骤

#### 步骤 1：安装依赖服务

**安装 MySQL：**
```bash
# Windows (使用 MySQL Installer 或 Chocolatey)
choco install mysql

# 或下载 MySQL Community Server
# https://dev.mysql.com/downloads/mysql/
```

**安装 Redis：**
```bash
# Windows (使用 Chocolatey)
choco install redis-64

# 或下载 Windows 版本
# https://github.com/microsoftarchive/redis/releases
```

#### 步骤 2：配置数据库

1. **创建数据库：**
```sql
CREATE DATABASE bluebell CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
```

2. **执行建表脚本：**
```bash
# 在 MySQL 中执行
mysql -u root -p bluebell < models/create_table.sql
```

或直接在 MySQL 客户端中执行 `models/create_table.sql` 文件内容。

#### 步骤 3：配置 Redis

确保 Redis 服务已启动：
```bash
# Windows
redis-server

# 或使用服务方式启动
```

#### 步骤 4：修改配置文件

编辑 `config.yaml`，根据实际情况修改：

```yaml
mysql:
  host: "127.0.0.1"        # 数据库地址
  port: 3306                # 数据库端口
  user: "root"              # 数据库用户名
  password: "你的密码"       #  修改为实际密码
  dbname: "bluebell"        # 数据库名

redis:
  host: "127.0.0.1"         # Redis 地址
  port: 6379                # Redis 端口
  password: ""              #  如果 Redis 设置了密码，填写密码
  db: 0
```

#### 步骤 5：安装 Go 依赖

```bash
# 在项目根目录执行
go mod download
```

#### 步骤 6：运行项目

```bash
# 方式1：直接运行
go run main.go

# 方式2：编译后运行
go build -o bell-best.exe
./bell-best.exe
```

#### 步骤 7：验证部署

1. **检查服务是否启动：**
   - 访问：http://127.0.0.1:8081/ping
   - 应该返回 "请登录"（需要 JWT token）

2. **查看 Swagger 文档：**
   - 访问：http://127.0.0.1:8081/swagger/index.html

3. **测试 API：**
   ```bash
   # 注册用户
   curl -X POST http://127.0.0.1:8081/api/v1/signup \
     -H "Content-Type: application/json" \
     -d '{"username":"test","password":"123456"}'
   
   # 登录
   curl -X POST http://127.0.0.1:8081/api/v1/login \
     -H "Content-Type: application/json" \
     -d '{"username":"test","password":"123456"}'
   ```

## 四、项目结构说明

```
bell-best/
├── config.yaml              # 配置文件
├── main.go                  # 程序入口
├── go.mod                   # Go 模块依赖
├── controller/              # 控制器层（处理 HTTP 请求）
├── dao/                     # 数据访问层
│   ├── mysql/              # MySQL 操作
│   └── redis/              # Redis 操作
├── logic/                   # 业务逻辑层
├── models/                  # 数据模型
│   └── create_table.sql    # 数据库建表脚本
├── router/                  # 路由配置
├── middlewares/             # 中间件（JWT 认证等）
├── setting/                 # 配置管理
├── logger/                  # 日志管理
├── pkg/                     # 公共包
│   ├── jwt/                # JWT 工具
│   └── snowflake/          # 雪花算法 ID 生成
└── docs/                    # Swagger 文档
```

## 五、API 接口列表

### 公开接口（无需认证）
- `POST /api/v1/signup` - 用户注册
- `POST /api/v1/login` - 用户登录
- `GET /api/v1/posts/` - 获取帖子列表
- `GET /api/v1/posts2/` - 获取帖子列表（支持排序）
- `GET /api/v1/community` - 获取社区列表
- `GET /api/v1/community/:id` - 获取社区详情
- `GET /api/v1/post/:id` - 获取帖子详情

### 需要认证的接口（需要 JWT Token）
- `POST /api/v1/post` - 创建帖子
- `POST /api/v1/vote` - 投票

**认证方式：**
在请求头中添加：`Authorization: Bearer <token>`



